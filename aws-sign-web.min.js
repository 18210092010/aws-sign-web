/**
 * AWS Signature v4 Implementation for Web Browsers
 *
 * Copyright (c) 2016-2018 Daniel Joos
 *
 * Distributed under MIT license. (See file LICENSE)
 */
!function(e,t){"function"==typeof define&&define.amd?define(["crypto-js/core","crypto-js/sha256","crypto-js/hmac-sha256"],t):"object"==typeof module&&module.exports?module.exports=t(require("crypto-js/core"),require("crypto-js/sha256"),require("crypto-js/hmac-sha256")):e.awsSignWeb=t(CryptoJS,CryptoJS.SHA256,CryptoJS.HmacSHA256)}(this,function(e){"use strict";var t={region:"eu-west-1",service:"execute-api",defaultContentType:"application/json",defaultAcceptType:"application/json",payloadSerializerFactory:function(){return function(e){return JSON.stringify(e)}},uriParserFactory:function(){var e=document?document.createElement("a"):{};return function(t){return e.href=t,{protocol:e.protocol,host:e.host.replace(/^(.*):((80)|(443))$/,"$1"),path:("/"!==e.pathname.charAt(0)?"/":"")+decodeURI(e.pathname),queryParams:(r=e.search,/^\??(.*)$/.exec(r)[1].split("&").reduce(function(e,t){return(t=/^(.+)=(.*)$/.exec(t))&&(e[decodeURI(t[1])]=decodeURI(t[2])),e},{}))};var r}},hasherFactory:function(){return{hash:function(t,r){r=o({hexOutput:!0,textInput:!0},r);var n=e.SHA256(t);return r.hexOutput?n.toString(e.enc.Hex):n},hmac:function(t,r,n){n=o({hexOutput:!0,textInput:!0},n);var a=e.HmacSHA256(r,t,{asBytes:!0});return n.hexOutput?a.toString(e.enc.Hex):a}}}},r=function(e){this.config=o({},t,e),this.payloadSerializer=this.config.payloadSerializer||this.config.payloadSerializerFactory(),this.uriParser=this.config.uriParserFactory(),this.hasher=this.config.hasherFactory(),s(this.config.accessKeyId,"AwsSigner requires AWS AccessKeyID"),s(this.config.secretAccessKey,"AwsSigner requires AWS SecretAccessKey")};r.prototype.sign=function(e,t){var r={request:o({},e),signDate:t||new Date,uri:this.uriParser(e.url)};!function(e,t){var r={host:t.uri.host,"content-type":e.config.defaultContentType,accept:e.config.defaultAcceptType,"x-amz-date":n(t.signDate)};e.config.defaultAcceptType||delete r.accept;e.config.defaultContentType||delete r["content-type"];t.request.method=t.request.method.toUpperCase(),t.request.body?t.payload=t.request.body:t.request.data&&e.payloadSerializer?t.payload=e.payloadSerializer(t.request.data):delete r["content-type"];t.request.headers=o(r,Object.keys(t.request.headers||{}).reduce(function(e,r){return e[r.toLowerCase()]=t.request.headers[r],e},{})),t.sortedHeaderKeys=Object.keys(t.request.headers).sort(),t.request.headers["content-type"]&&(t.request.headers["content-type"]=t.request.headers["content-type"].split(";")[0]);"object"==typeof t.request.params&&o(t.uri.queryParams,t.request.params)}(this,r),s=this,(i=r).signedHeaders=i.sortedHeaderKeys.map(function(e){return e.toLowerCase()}).join(";"),i.canonicalRequest=String(i.request.method).toUpperCase()+"\n"+i.uri.path.split("/").map(function(e){return a(e)}).join("/")+"\n"+Object.keys(i.uri.queryParams).sort().map(function(e){return a(e)+"="+a(i.uri.queryParams[e])}).join("&")+"\n"+i.sortedHeaderKeys.map(function(e){return e.toLocaleLowerCase()+":"+i.request.headers[e]}).join("\n")+"\n\n"+i.signedHeaders+"\n"+s.hasher.hash(i.payload?i.payload:"");var s,i;c=this,(u=r).credentialScope=[n(u.signDate,!0),c.config.region,c.config.service,"aws4_request"].join("/"),u.stringToSign="AWS4-HMAC-SHA256\n"+n(u.signDate)+"\n"+u.credentialScope+"\n"+c.hasher.hash(u.canonicalRequest);var c,u;!function(e,t){var r=e.hasher.hmac,a=r(r(r(r("AWS4"+e.config.secretAccessKey,n(t.signDate,!0),{hexOutput:!1}),e.config.region,{hexOutput:!1,textInput:!1}),e.config.service,{hexOutput:!1,textInput:!1}),"aws4_request",{hexOutput:!1,textInput:!1});t.signature=r(a,t.stringToSign,{textInput:!1})}(this,r),(p=r).authorization="AWS4-HMAC-SHA256 Credential="+this.config.accessKeyId+"/"+p.credentialScope+", SignedHeaders="+p.signedHeaders+", Signature="+p.signature;var p;return{Accept:r.request.headers.accept,Authorization:r.authorization,"Content-Type":r.request.headers["content-type"],"x-amz-date":r.request.headers["x-amz-date"],"x-amz-security-token":this.config.sessionToken||void 0}};function n(e,t){var r=e.toISOString().replace(/[:\-]|\.\d{3}/g,"").substr(0,17);return t?r.substr(0,8):r}function a(e){return encodeURIComponent(e).replace(/[!'()*]/g,function(e){return"%"+e.charCodeAt(0).toString(16).toUpperCase()})}function o(e){return[].slice.call(arguments,1).forEach(function(t){t&&"object"==typeof t&&Object.keys(t).forEach(function(r){var n=t[r];void 0!==n&&(null!==n&&"object"==typeof n?(e[r]=Array.isArray(n)?[]:{},o(e[r],n)):e[r]=n)})}),e}function s(e,t){if(void 0===e||!e)throw new Error(t)}return{AwsSigner:r}});